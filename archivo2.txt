CREATE OR REPLACE PROCEDURE DVILLALVA.PRUEBA_CURSOR_FOTO(OUT CADENA VARCHAR(2000))
LANGUAGE SQL
DYNAMIC RESULT SETS 1
SET OPTION DBGVIEW = *SOURCE, OUTPUT = *PRINT
BEGIN 
DECLARE VCADENA VARCHAR ( 200 ) DEFAULT '' ; 
DECLARE VCADENA_EJECUCION VARCHAR ( 6000 ) DEFAULT '' ; 
DECLARE VNOMBRE_ARCHIVO VARCHAR ( 10 ) DEFAULT 'CLIENTE' ; 


DECLARE C1 CURSOR	FOR CONSULTA;

FOR A AS 
SELECT CAMPOS_REQUIEREN_LOG crl

FOR v_row as 
        SELECT DISTINCT ARCHIVO, CAMPO 
        FROM CLIENTES.LOG_CLIENTES 
        WHERE ID = 100025463789 AND TRIM(CAMPO) 
        IN('PERFIL' , 'PERFIL_VENTAS_MENSUALES','CONTROL_TERRORISTA','ESPECIAL_ID','ESTADO_ID')
        AND TRIM(ARCHIVO) = 'CLIENTE'
        DO 
SET VCADENA_EJECUCION = TRIM(VCADENA_EJECUCION)||
''''||v_row.CAMPO ||''' VALUE '||TRIM(v_row.CAMPO)||', ';
END FOR;

SET CADENA = 'SELECT DISTINCT json_object ('||RTRIM(TRIM(VCADENA_EJECUCION), ',')||
' )  FROM CLIENTES.'||VNOMBRE_ARCHIVO || ' C ' ||
' WHERE C.ID = '|| 100025463789;

PREPARE CONSULTA 
	FROM CADENA;

 OPEN C1;

RETURN ; 
END;   
  
 
CALL DVILLALVA.PRUEBA_CURSOR(?);

SELECT DISTINCT ARCHIVO, CAMPO 
        FROM CLIENTES.LOG_CLIENTES 
        WHERE ID = 100025463789 AND TRIM(CAMPO) 
        IN('PERFIL' , 'PERFIL_VENTAS_MENSUALES','CONTROL_TERRORISTA','ESPECIAL_ID','ESTADO_ID');